# HOP08 – BASH – Shell Functions

> 8/28/22

## IS 340 – Operating Systems

## School of Technology & Computing (STC) @ City University of Seattle (CityU)

---

### Preparation

1.  Connect to your Ubuntu instance
    Open a command prompt
    Syntax: `ssh -i LOCATION_OF_YOUR_KEY ubuntu@PULIC_DNS`

    **Example:**

```sh
ssh -i key.pem ubuntu@ec2-33-222-101-222.us-west-2.compute.amazonaws.com
```

2. Navigate to your name directory under the IS340-Summer-2020

   ```
   cd ~/ IS340-Summer-2020/YOURNAME
   ```

   > **Note**: change `YOURNAME` to your real name

3. Create a `Module8` directory under YOURNAME directory.
   Note: If this directory exists, skip this step.

```sh
mkdir Module8
```

4. Navigate to the Module8 directory.

   ```sh
   cd Module8
   ```

Define a function in the shell

1. The bash supports three different syntaxes for defining a function:

   - function name <compound command>
   - name() <compound command>
   - function name() <compound command>
     > In this module, we will use the second syntax.

2. Define a function in the shell by typing the following command:

   ```sh
   circleArea() ( area=`echo "3.1415926 * $1 * $1" | bc -l`; printf "The circle's area is %s\n" "$area" )
   ```

   Note: the script uses the bc command to calculate float numbers. The syntax is variable=`echo “formula” | bc -l`

3. Test the script by typing the following commands:

   ```sh
   circleArea 12
   ```

4. You can save the print result to a variable for future usage. Try it by typing the following commands:

   ```sh
   info=$( circleArea 5 )
   echo $info
   ```

   Note: you can use this method to get a return value from a function

5. The function also can return an exit code (0 - 255). Test it by typing the following commands:

   ```sh
   getNumber() ( return $(( $RANDOM \* 255 + 1 )) )
   getNumber
   echo $?
   getNumber
   echo $?
   getNumber
   echo $?
   ```

   - **Note**: The $? represents the last exit code which we returned from the function. You are supposed to see different numbers since our function returns a random number every time it is executed.

## Define a function in the file

1. Functions defined in the shell will lose after you close the shell. It is good to write your functions in the file for the reusability

2. Create a script file by typing the following command:

   ```sh
   nano SystemSnapshot.sh
   ```

   - **Note**: we define a function called snapshot to take a system snapshot by running top command and save the information to a file with the name contains date and time that snapshot was taken.

3. Hit the `[control + x]` key to quit and save the file.

4. Before we can use the function that defines in a file, we have to source in the file in the current shell, making functions available to the shell. Run the following command to source in the file:

   ```sh
   . SystemSnapshot.sh
   ```

5. Try to run the function by typing the following command:

   ```sh
   snapshot
   clear
   ```

   - We run clear to clear the screen in order to see the file content later.

6. Run the following command to see file names in the folder:

   ```sh
   ls
   ```

You will see a different file name because it was generated by the date and time you run the function.

7. Check the file content by typing the following command:

   ```sh
   cat 2019-07-1802:16:22.log
   ```

   - **Note**: you should change the file name to your own file name.

### Submit your Work to Brightspace

    Please upload all your files for this hands-on practice to the HOP assignment on Brightspace.

---

### Command List

```sh
 mkdir CS340-Summer-2022/ThaddeusThomas/Module08
 mkdir Module8
 cd Module08
 ------------------------
 circleArea() ( area=`echo "3.1415926 * $1 * $1" | bc -l`; printf "The circle's area is %s\n" "$area" )
 ---------------------
 circleArea 12
 ----------------------
 info=$( circleArea 5 )
 echo $info
 -----------------------------------------------
 getNumber() ( return $(( $RANDOM \* 255 + 1 )) )
 getNumber
 echo $?
 getNumber
 echo $?
 getNumber
 echo $?
 --------------------------------------------------
 nano SystemSnapshot.sh
 --------------------------------------------------
 #! /bin/bash
 snapshot() {
 filename=$(date '+%Y-%m-%d%H:%M:%S').log
 top -n 1 | tee "$filename"
 }
 -----------------------
 sudo chmod 700 SystemSnapshot.sh
 -----------------------
 snapshot
 clear
 -----------------------
 ls
 -----------------------
 cat <log file name>
```
